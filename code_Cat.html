<html><head>
<link rel="stylesheet" href="style.css" type="text/css">
<meta content="text/html; charset=iso-8859-1" http-equiv="Content-Type">
<link rel="Start" href="index.html">
<link title="Index of types" rel=Appendix href="index_types.html">
<link title="Index of values" rel=Appendix href="index_values.html">
<link title="Index of modules" rel=Appendix href="index_modules.html">
<link title="HelloWrong" rel="Chapter" href="HelloWrong.html">
<link title="HelloRight" rel="Chapter" href="HelloRight.html">
<link title="HelloCommand" rel="Chapter" href="HelloCommand.html">
<link title="Basics" rel="Chapter" href="Basics.html">
<link title="Choices" rel="Chapter" href="Choices.html">
<link title="Pipes" rel="Chapter" href="Pipes.html">
<link title="Ivars" rel="Chapter" href="Ivars.html">
<link title="MoreChoices" rel="Chapter" href="MoreChoices.html">
<link title="MorePipes" rel="Chapter" href="MorePipes.html">
<link title="StdinLine" rel="Chapter" href="StdinLine.html">
<link title="StdoutLine" rel="Chapter" href="StdoutLine.html">
<link title="StdinAll" rel="Chapter" href="StdinAll.html">
<link title="WriteString" rel="Chapter" href="WriteString.html">
<link title="WriteLine" rel="Chapter" href="WriteLine.html">
<link title="WriteWith" rel="Chapter" href="WriteWith.html">
<link title="Diary" rel="Chapter" href="Diary.html">
<link title="Cat" rel="Chapter" href="Cat.html">
<link title="PrintServer" rel="Chapter" href="PrintServer.html">
<link title="EchoOnceServer" rel="Chapter" href="EchoOnceServer.html">
<link title="EchoServer" rel="Chapter" href="EchoServer.html">
<link title="ExitEchoServer" rel="Chapter" href="ExitEchoServer.html">
<link title="PrintClient" rel="Chapter" href="PrintClient.html">
<link title="EchoClient" rel="Chapter" href="EchoClient.html">
<link title="TcpShell" rel="Chapter" href="TcpShell.html">
<link title="KeyValueStore" rel="Chapter" href="KeyValueStore.html">
<link title="RedisOp" rel="Chapter" href="RedisOp.html">
<link title="Redis" rel="Chapter" href="Redis.html">
<link title="HandCard" rel="Chapter" href="HandCard.html">
<link title="SexpCard" rel="Chapter" href="SexpCard.html">
<link title="MarshalCard" rel="Chapter" href="MarshalCard.html">
<link title="BinioCard" rel="Chapter" href="BinioCard.html">
<link title="ArithMarshal" rel="Chapter" href="ArithMarshal.html">
<link title="MarshalClient" rel="Chapter" href="MarshalClient.html">
<link title="MarshalServer" rel="Chapter" href="MarshalServer.html">
<link title="ArithSexp" rel="Chapter" href="ArithSexp.html">
<link title="SexpClient" rel="Chapter" href="SexpClient.html">
<link title="SexpServer" rel="Chapter" href="SexpServer.html">
<link title="ToStringProtocol" rel="Chapter" href="ToStringProtocol.html">
<link title="ToStringClient" rel="Chapter" href="ToStringClient.html">
<link title="ToStringServer" rel="Chapter" href="ToStringServer.html">
<link title="ArithRpc" rel="Chapter" href="ArithRpc.html">
<link title="RpcClient" rel="Chapter" href="RpcClient.html">
<link title="RpcServer" rel="Chapter" href="RpcServer.html">
<link title="Ephemeral" rel="Chapter" href="Ephemeral.html">
<link title="Fsync" rel="Chapter" href="Fsync.html">
<link title="LevelDb" rel="Chapter" href="LevelDb.html">
<link title="MoreLevelDb" rel="Chapter" href="MoreLevelDb.html">
<link title="HelloServer" rel="Chapter" href="HelloServer.html">
<link title="HelloGetServer" rel="Chapter" href="HelloGetServer.html">
<link title="HelloHtmlServer" rel="Chapter" href="HelloHtmlServer.html"><title>Cat</title>
</head>
<body>
<code class="code"><span class="comment">(*&nbsp;In&nbsp;this&nbsp;program,&nbsp;we'll&nbsp;write&nbsp;a&nbsp;simplified&nbsp;version&nbsp;of&nbsp;the&nbsp;command&nbsp;line<br>
&nbsp;*&nbsp;utility&nbsp;cat.&nbsp;When&nbsp;cat&nbsp;is&nbsp;invoked&nbsp;with&nbsp;no&nbsp;arguments,&nbsp;it&nbsp;echoes&nbsp;user&nbsp;input<br>
&nbsp;*&nbsp;line&nbsp;by&nbsp;line.&nbsp;When&nbsp;passed&nbsp;a&nbsp;list&nbsp;of&nbsp;filenames,&nbsp;cat&nbsp;prints&nbsp;the&nbsp;contents&nbsp;of<br>
&nbsp;*&nbsp;each&nbsp;file&nbsp;to&nbsp;the&nbsp;screen.&nbsp;Cat&nbsp;also&nbsp;has&nbsp;a&nbsp;bunch&nbsp;of&nbsp;command&nbsp;line&nbsp;flags&nbsp;to&nbsp;alter<br>
&nbsp;*&nbsp;its&nbsp;behaviour,&nbsp;but&nbsp;we&nbsp;won't&nbsp;implement&nbsp;any&nbsp;of&nbsp;those.&nbsp;*)</span><br>
<span class="keyword">open</span>&nbsp;<span class="constructor">Core</span>.<span class="constructor">Std</span><br>
<span class="keyword">open</span>&nbsp;<span class="constructor">Async</span>.<span class="constructor">Std</span><br>
<br>
<span class="keyword">let</span>&nbsp;readme&nbsp;()&nbsp;=<br>
&nbsp;&nbsp;<span class="string">"Concatenate&nbsp;FILE(s),&nbsp;or&nbsp;standard&nbsp;input,&nbsp;to&nbsp;standard&nbsp;output"</span><br>
<br>
<span class="comment">(*&nbsp;First,&nbsp;we&nbsp;write&nbsp;a&nbsp;function&nbsp;to&nbsp;transfer&nbsp;stdin&nbsp;to&nbsp;stdout.&nbsp;*)</span><br>
<span class="keyword">let</span>&nbsp;cat_stdin&nbsp;()&nbsp;=<br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;stdin&nbsp;&nbsp;=&nbsp;<span class="constructor">Lazy</span>.force&nbsp;<span class="constructor">Reader</span>.stdin&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;stdout&nbsp;=&nbsp;<span class="constructor">Lazy</span>.force&nbsp;<span class="constructor">Writer</span>.stdout&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="constructor">Reader</span>.transfer&nbsp;stdin&nbsp;(<span class="constructor">Writer</span>.pipe&nbsp;stdout)<br>
<br>
<span class="comment">(*&nbsp;Next,&nbsp;we&nbsp;write&nbsp;a&nbsp;function&nbsp;to&nbsp;print&nbsp;the&nbsp;contents&nbsp;of&nbsp;a&nbsp;file.&nbsp;*)</span><br>
<span class="keyword">let</span>&nbsp;cat_file&nbsp;filename&nbsp;=<br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;stdout&nbsp;=&nbsp;<span class="constructor">Lazy</span>.force&nbsp;<span class="constructor">Writer</span>.stdout&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="constructor">Reader</span>.with_file&nbsp;filename<br>
&nbsp;&nbsp;&nbsp;&nbsp;~f:(<span class="keyword">fun</span>&nbsp;file&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Reader</span>.transfer&nbsp;file&nbsp;(<span class="constructor">Writer</span>.pipe&nbsp;stdout))<br>
<br>
<span class="comment">(*&nbsp;Finally,&nbsp;we&nbsp;write&nbsp;our&nbsp;main&nbsp;function.&nbsp;If&nbsp;the&nbsp;user&nbsp;didn't&nbsp;specify&nbsp;any<br>
&nbsp;*&nbsp;filenames,&nbsp;we&nbsp;echo&nbsp;stdin.&nbsp;Otherwise,&nbsp;we&nbsp;print&nbsp;out&nbsp;the&nbsp;contents&nbsp;of&nbsp;the<br>
&nbsp;*&nbsp;provided&nbsp;files.&nbsp;*)</span><br>
<span class="keyword">let</span>&nbsp;main&nbsp;filenames&nbsp;()&nbsp;:&nbsp;unit&nbsp;<span class="constructor">Deferred</span>.t&nbsp;=<br>
&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;filenames&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;[]&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;cat_stdin&nbsp;()<br>
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;fs&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Deferred</span>.<span class="constructor">List</span>.iter&nbsp;fs&nbsp;~f:cat_file<br>
<br>
<span class="keyword">let</span>&nbsp;()&nbsp;=<br>
&nbsp;&nbsp;<span class="constructor">Command</span>.async<br>
&nbsp;&nbsp;&nbsp;&nbsp;~summary:<span class="string">"concatenate&nbsp;files&nbsp;and&nbsp;print&nbsp;on&nbsp;the&nbsp;standard&nbsp;output"</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;~readme:readme<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Command</span>.<span class="constructor">Spec</span>.(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;empty<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&gt;&nbsp;anon&nbsp;(sequence&nbsp;(<span class="string">"FILE"</span>&nbsp;%:&nbsp;file))<br>
&nbsp;&nbsp;&nbsp;&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;main<br>
&nbsp;&nbsp;|&gt;&nbsp;<span class="constructor">Command</span>.run<br>
</code></body></html>
<html><head>
<link rel="stylesheet" href="style.css" type="text/css">
<meta content="text/html; charset=iso-8859-1" http-equiv="Content-Type">
<link rel="Start" href="index.html">
<link title="Index of types" rel=Appendix href="index_types.html">
<link title="Index of values" rel=Appendix href="index_values.html">
<link title="Index of modules" rel=Appendix href="index_modules.html">
<link title="HelloWrong" rel="Chapter" href="HelloWrong.html">
<link title="HelloRight" rel="Chapter" href="HelloRight.html">
<link title="HelloCommand" rel="Chapter" href="HelloCommand.html">
<link title="Basics" rel="Chapter" href="Basics.html">
<link title="Choices" rel="Chapter" href="Choices.html">
<link title="Pipes" rel="Chapter" href="Pipes.html">
<link title="Ivars" rel="Chapter" href="Ivars.html">
<link title="MoreChoices" rel="Chapter" href="MoreChoices.html">
<link title="MorePipes" rel="Chapter" href="MorePipes.html">
<link title="StdinLine" rel="Chapter" href="StdinLine.html">
<link title="StdoutLine" rel="Chapter" href="StdoutLine.html">
<link title="StdinAll" rel="Chapter" href="StdinAll.html">
<link title="WriteString" rel="Chapter" href="WriteString.html">
<link title="WriteLine" rel="Chapter" href="WriteLine.html">
<link title="WriteWith" rel="Chapter" href="WriteWith.html">
<link title="Diary" rel="Chapter" href="Diary.html">
<link title="Cat" rel="Chapter" href="Cat.html">
<link title="PrintServer" rel="Chapter" href="PrintServer.html">
<link title="EchoOnceServer" rel="Chapter" href="EchoOnceServer.html">
<link title="EchoServer" rel="Chapter" href="EchoServer.html">
<link title="ExitEchoServer" rel="Chapter" href="ExitEchoServer.html">
<link title="PrintClient" rel="Chapter" href="PrintClient.html">
<link title="EchoClient" rel="Chapter" href="EchoClient.html">
<link title="TcpShell" rel="Chapter" href="TcpShell.html">
<link title="KeyValueStore" rel="Chapter" href="KeyValueStore.html">
<link title="RedisOp" rel="Chapter" href="RedisOp.html">
<link title="Redis" rel="Chapter" href="Redis.html">
<link title="HandCard" rel="Chapter" href="HandCard.html">
<link title="SexpCard" rel="Chapter" href="SexpCard.html">
<link title="MarshalCard" rel="Chapter" href="MarshalCard.html">
<link title="BinioCard" rel="Chapter" href="BinioCard.html">
<link title="ArithMarshal" rel="Chapter" href="ArithMarshal.html">
<link title="MarshalClient" rel="Chapter" href="MarshalClient.html">
<link title="MarshalServer" rel="Chapter" href="MarshalServer.html">
<link title="ArithSexp" rel="Chapter" href="ArithSexp.html">
<link title="SexpClient" rel="Chapter" href="SexpClient.html">
<link title="SexpServer" rel="Chapter" href="SexpServer.html">
<link title="ToStringProtocol" rel="Chapter" href="ToStringProtocol.html">
<link title="ToStringClient" rel="Chapter" href="ToStringClient.html">
<link title="ToStringServer" rel="Chapter" href="ToStringServer.html">
<link title="ArithRpc" rel="Chapter" href="ArithRpc.html">
<link title="RpcClient" rel="Chapter" href="RpcClient.html">
<link title="RpcServer" rel="Chapter" href="RpcServer.html">
<link title="Ephemeral" rel="Chapter" href="Ephemeral.html">
<link title="Fsync" rel="Chapter" href="Fsync.html">
<link title="LevelDb" rel="Chapter" href="LevelDb.html">
<link title="MoreLevelDb" rel="Chapter" href="MoreLevelDb.html">
<link title="HelloServer" rel="Chapter" href="HelloServer.html">
<link title="HelloGetServer" rel="Chapter" href="HelloGetServer.html">
<link title="HelloHtmlServer" rel="Chapter" href="HelloHtmlServer.html"><title>StdinLine.main</title>
</head>
<body>
<code class="code"><span class="keyword">let</span>&nbsp;main&nbsp;()&nbsp;:&nbsp;unit&nbsp;<span class="constructor">Deferred</span>.t&nbsp;=<br>
&nbsp;&nbsp;<span class="comment">(*&nbsp;First&nbsp;up,&nbsp;we&nbsp;create&nbsp;a&nbsp;Reader.t&nbsp;from&nbsp;stdin.&nbsp;Luckily,&nbsp;the&nbsp;Reader&nbsp;module&nbsp;has<br>
&nbsp;&nbsp;&nbsp;*&nbsp;exactly&nbsp;this&nbsp;already!&nbsp;The&nbsp;only&nbsp;hiccup&nbsp;is&nbsp;that&nbsp;Reader.stdin&nbsp;is&nbsp;of&nbsp;type<br>
&nbsp;&nbsp;&nbsp;*&nbsp;`Reader.t&nbsp;Core.Std.Lazy.t`.&nbsp;It's&nbsp;not&nbsp;too&nbsp;important&nbsp;what&nbsp;that&nbsp;means;&nbsp;all&nbsp;we<br>
&nbsp;&nbsp;&nbsp;*&nbsp;have&nbsp;to&nbsp;do&nbsp;is&nbsp;call&nbsp;Lazy.force&nbsp;to&nbsp;get&nbsp;the&nbsp;Reader.t&nbsp;we're&nbsp;looking&nbsp;for.&nbsp;*)</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;stdin&nbsp;=&nbsp;<span class="constructor">Lazy</span>.force&nbsp;<span class="constructor">Reader</span>.stdin&nbsp;<span class="keyword">in</span><br>
<br>
&nbsp;&nbsp;<span class="comment">(*&nbsp;The&nbsp;Reader&nbsp;module&nbsp;has&nbsp;a&nbsp;lot&nbsp;of&nbsp;functions&nbsp;to&nbsp;read&nbsp;from&nbsp;a&nbsp;Reader.t:<br>
&nbsp;&nbsp;&nbsp;*&nbsp;Reader.read,&nbsp;Reader.read_char,&nbsp;Reader.really_read,&nbsp;etc.&nbsp;For&nbsp;now,&nbsp;we&nbsp;just<br>
&nbsp;&nbsp;&nbsp;*&nbsp;want&nbsp;to&nbsp;read&nbsp;a&nbsp;single&nbsp;from&nbsp;the&nbsp;user,&nbsp;so&nbsp;we'll&nbsp;use&nbsp;Reader.read_line.&nbsp;As<br>
&nbsp;&nbsp;&nbsp;*&nbsp;the&nbsp;name&nbsp;suggests,&nbsp;it&nbsp;reads&nbsp;all&nbsp;the&nbsp;data&nbsp;up&nbsp;to&nbsp;and&nbsp;including&nbsp;the&nbsp;newline<br>
&nbsp;&nbsp;&nbsp;*&nbsp;character.<br>
&nbsp;&nbsp;&nbsp;*<br>
&nbsp;&nbsp;&nbsp;*&nbsp;Of&nbsp;course,&nbsp;reading&nbsp;could&nbsp;go&nbsp;wrong.&nbsp;For&nbsp;example,&nbsp;we&nbsp;could&nbsp;read&nbsp;from&nbsp;a&nbsp;file<br>
&nbsp;&nbsp;&nbsp;*&nbsp;that's&nbsp;been&nbsp;deleted&nbsp;or&nbsp;read&nbsp;from&nbsp;a&nbsp;TCP&nbsp;connection&nbsp;that's&nbsp;been&nbsp;closed.&nbsp;So,<br>
&nbsp;&nbsp;&nbsp;*&nbsp;Reader.read_line,&nbsp;and&nbsp;all&nbsp;the&nbsp;other&nbsp;reading&nbsp;functions&nbsp;in&nbsp;the&nbsp;Reader<br>
&nbsp;&nbsp;&nbsp;*&nbsp;module,&nbsp;return&nbsp;a&nbsp;Read_result.t.&nbsp;A&nbsp;Read_result.t&nbsp;is&nbsp;either&nbsp;`Eof&nbsp;(signifying<br>
&nbsp;&nbsp;&nbsp;*&nbsp;we've&nbsp;hit&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;reader)&nbsp;or&nbsp;an&nbsp;`Ok&nbsp;x,&nbsp;where&nbsp;the&nbsp;x&nbsp;is&nbsp;the&nbsp;data<br>
&nbsp;&nbsp;&nbsp;*&nbsp;we're&nbsp;after.&nbsp;If&nbsp;our&nbsp;read&nbsp;here&nbsp;doesn't&nbsp;work,&nbsp;we'll&nbsp;just&nbsp;print&nbsp;"error".<br>
&nbsp;&nbsp;&nbsp;*&nbsp;Otherwise,&nbsp;we'll&nbsp;print&nbsp;whatever&nbsp;line&nbsp;the&nbsp;user&nbsp;typed&nbsp;in.&nbsp;*)</span><br>
&nbsp;&nbsp;<span class="constructor">Reader</span>.read_line&nbsp;stdin&nbsp;&gt;&gt;|&nbsp;<span class="keyword">function</span><br>
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="keywordsign">`</span><span class="constructor">Eof</span>&nbsp;&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;print_endline&nbsp;<span class="string">"error"</span><br>
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="keywordsign">`</span><span class="constructor">Ok</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;print_endline&nbsp;x</code></body></html>